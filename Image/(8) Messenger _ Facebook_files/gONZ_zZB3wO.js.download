if (self.CavalryLogger) { CavalryLogger.start_js(["muhts"]); }

__d("StoriesFeedbackEmojiPicker",["ix","fbt","CometComposerSproutButton.react","CometComposerTaggerPluginTypes","CometLazyPopoverTrigger.react","CometPopoverLoadingState.react","JSResource","React","asset"],(function(a,b,c,d,e,f,g,h){"use strict";var i=b("React"),j=b("JSResource")("EmojiPickerContainer.react").__setRef("StoriesFeedbackEmojiPicker");function a(a){var c=a.onSelect;a=a.onVisibilityChange;return i.jsx(b("CometLazyPopoverTrigger.react"),{align:"end",fallback:i.jsx(b("CometPopoverLoadingState.react"),{minWidth:320,withArrow:!0}),onVisibilityChange:a,popoverProps:{onSelect:c},popoverResource:j,position:"above",preloadTrigger:"button",children:function(a,c,d,e,f,j){return i.jsx(b("CometComposerSproutButton.react"),{disabledIcon:g("615744"),icon:g("792301"),label:h._("Emoji"),onClick:c,onHoverIn:e,onHoverOut:f,onPressIn:j,overlayDisabled:!0,pluginName:b("CometComposerTaggerPluginTypes").MINUTIAE,ref:a})}})}e.exports=a}),null);
__d("useStoriesFeedbackEditorState",["DeferredDraftEditor.react","EditorState","EmojiInputDecorator","EmojiSpan.react","React","usePrevious"],(function(a,b,c,d,e,f){"use strict";a=b("React");var g=a.useCallback,h=a.useEffect,i=a.useRef,j=a.useState,k=function(){var a=b("DeferredDraftEditor.react").createEmptyComposerState();if(a.__type==="editor-state-based"){var c=a.draftEditorState.getDecorator();(c==null||c.getComponentForKey("EmojiInputDecorator"))&&(a=babelHelpers["extends"]({},a,{draftEditorState:b("EditorState").set(a.draftEditorState,{decorator:new(b("EmojiInputDecorator"))(b("EmojiSpan.react"),c,{size:16})})}))}return a};c=function(a){var c=j(function(){return k()}),d=c[0],e=c[1],f=i((c={},c[a]=d,c)),l=b("usePrevious")(a);h(function(){a!==l&&(f.current[a]==null&&(f.current[a]=k()),l!=null&&(f.current[l]=d),e(f.current[a]))},[a,d,l]);c=g(function(){f.current[a]=k(),e(f.current[a])},[a]);return{editorState:d,resetEditorState:c,setEditorState:e}};e.exports=c}),null);
__d("useStoriesFeedbackKeyboardCommandsConfig",["fbt","CometKeys","React"],(function(a,b,c,d,e,f,g){"use strict";c=b("React");var h=c.useMemo;function a(a){var c=a.onDelete,d=a.onEnter,e=a.onEscape;a=h(function(){return[{command:{key:b("CometKeys").DELETE},description:g._("Delete character"),handler:c,triggerFromInputs:!0},{command:{key:b("CometKeys").ENTER},description:g._("Send story reply"),handler:d,triggerFromInputs:!0},{command:{key:b("CometKeys").ESCAPE},description:g._("Stop reply editing"),handler:e,triggerFromInputs:!0}]},[c,d,e]);return a}e.exports=a}),null);
__d("StoriesFeedbackDraftEditor.react",["ix","fbt","CometComponentWithKeyCommands.react","CometPressable.react","DeferredDraftEditor.react","DraftModifier","EditorState","React","StoriesFeedbackEmojiPicker","TetraIcon.react","fbicon","getPlainTextFromDeferredDraftEditorState","keyCommandBackspaceEmoji","keyCommandDeleteEmoji","stylex","useGlobalEventListener","useStoriesFeedbackEditorState","useStoriesFeedbackKeyboardCommandsConfig"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=b("React");c=b("React");var k=c.useCallback,l=c.useRef,m=c.useState,n={accessibleElement:{clip:"svngc6pa",height:"ay7djpcl",overflowX:"ni8dbmo4",overflowY:"stjgntxs",position:"pmk7jnqg",whiteSpace:"g0qnabr5",width:"rfua0xdk"},actionButtons:{alignItems:"bp9cbjyn",display:"j83agx80",marginEnd:"o3lre8g0"},feedbackDraftEditor:{alignItems:"bp9cbjyn",display:"j83agx80",flexDirection:"btwxx1t3",width:"k4urcfbm"},input:{height:"p1ueia1e",overflowX:"ni8dbmo4",overflowY:"stjgntxs",width:"k4urcfbm"},sendButton:{marginStart:"hnxzwevs"}};function a(a){var c=a.cardID,d=a.onBlur,e=a.onFocus,f=a.onSend;a=a.placeholder;var o=m(!1),p=o[0],q=o[1];o=b("useStoriesFeedbackEditorState")(c);var r=o.editorState,s=o.resetEditorState,t=o.setEditorState,u=l(null),v=l(null),w=l(!1),x=l(null);b("useGlobalEventListener")("keydown",function(a){var b=x.current;if(b&&!a.target.contains(b))return;b=String.fromCharCode(a.keyCode);b.match(/\w/)&&(x.current&&x.current.focus())});var y=k(function(a){a===void 0&&(a=!0);if(w.current)return;window.clearTimeout(u.current);u.current=window.setTimeout(function(){q(!1),d(),a&&(x.current&&x.current.blur())})},[d]);c=k(function(){window.clearTimeout(u.current),q(!0),e()},[q,e]);b("useGlobalEventListener")("click",k(function(a){if(!p)return;var b=v.current;if(a.target===b||b.contains(a.target))return;y()},[p,y]));var z=b("getPlainTextFromDeferredDraftEditorState")(r).trim(),A=z==="";o=k(function(){if(A)return;f(z);s();y()},[y,A,f,s,z]);var B=k(function(a){if(r.__type==="editor-state-based"){var c=null;a==="delete"?c=b("keyCommandDeleteEmoji"):a==="backspace"&&(c=b("keyCommandBackspaceEmoji"));if(c!=null){a=c(r.draftEditorState);a!=null&&t(babelHelpers["extends"]({},r,{draftEditorState:a}))}}},[r,t]),C=b("useStoriesFeedbackKeyboardCommandsConfig")({onDelete:B.bind(null,"backspace"),onEnter:o,onEscape:y}),D=function(a){if(a==="delete"){B("delete");return"handled"}return"not-handled"},E=function(a){a=String.fromCodePoint(a[0]);r;if((r==null?void 0:r.__type)==="editor-state-based"){var c=b("DraftModifier").replaceText(r.draftEditorState.getCurrentContent(),r.draftEditorState.getSelection(),a);c=babelHelpers["extends"]({},r,{draftEditorState:b("EditorState").push(r.draftEditorState,c,"insert-characters")})}else c=babelHelpers["extends"]({},r,{text:a});t(c)};return j.jsxs("div",{className:(i||(i=b("stylex")))(n.feedbackDraftEditor),onBlurCapture:function(a){y(a.target===x.current)},onFocusCapture:c,ref:v,children:[j.jsx(b("CometComponentWithKeyCommands.react"),{commandConfigs:C,xstyle:n.input,children:j.jsx(b("DeferredDraftEditor.react"),{customStyleFn:function(){return{whiteSpace:"pre",wordWrap:"normal"}},editorState:r,handleKeyCommand:D,handleReturn:function(a){a.preventDefault();return"handled"},onInputRefUpdate:function(a){x.current=a},onStateChange:function(a){t(a)},placeholder:a})}),j.jsxs("div",{className:i(n.actionButtons,!p&&n.accessibleElement),children:[j.jsx(b("StoriesFeedbackEmojiPicker"),{onSelect:E,onVisibilityChange:function(a){w.current=a}}),j.jsx(b("CometPressable.react"),{"aria-label":h._("Send button for story text reply"),disabled:A,hideHoverOverlay:!0,onPress:o,testid:void 0,xstyle:n.sendButton,children:j.jsx(b("TetraIcon.react"),{color:A?"disabled":"white",icon:b("fbicon")._(g("579031"),20),size:20})})]})]})}e.exports=a}),null);