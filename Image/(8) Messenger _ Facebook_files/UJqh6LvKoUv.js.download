if (self.CavalryLogger) { CavalryLogger.start_js(["nUdar"]); }

__d("CometNewsFeedConnectionHandlerModern",["FBLogger","RelayFBConnectionHandler_UNSTABLE","recoverableViolation","relay-runtime","unrecoverableViolation"],(function(a,b,c,d,e,f){"use strict";var g,h=(g=b("relay-runtime")).ConnectionHandler,i=g.ConnectionInterface,j=g.generateClientID,k=g.getRelayHandleKey,l="comet_news_feed",m="__connection_next_edge_index",n="received_edges_count";function a(a,c){var d,e=a.get(c.dataID);if(!e)return;var f=i.get(),g=f.EDGES,k=f.PAGE_INFO;f=f.PAGE_INFO_TYPE;if(c.args.before!=null)throw b("unrecoverableViolation")("The newsfeed connection does not support backward pagination by design","comet_feed");var l=e.getLinkedRecord(c.fieldKey);if(!l){b("FBLogger")("comet_feed").mustfix("Newsfeed connection is null in the store, this means no feed stories will be shown");return}var q=j(e.getDataID(),c.handleKey),r=e.getLinkedRecord(c.handleKey);d=(d=r)!=null?d:a.get(q);var s=d&&d.getLinkedRecord(k);if(!d){var t=a.create(q,l.getType());t.setValue(0,m);t.copyFieldsFrom(l);q=l.getLinkedRecords(g);q&&(q=q.map(function(b){return h.buildConnectionEdge(a,t,b)}),t.setLinkedRecords(q,g),t.setValue(q.length,n));e.setLinkedRecord(t,c.handleKey);s=a.create(j(t.getDataID(),k),f);o(q,q,t,s);return}r==null&&e.setLinkedRecord(d,c.handleKey);var u=d;k=l.getLinkedRecords(g);k&&(k=k.map(function(b){return h.buildConnectionEdge(a,u,b)}),u.setValue(k.length,n));f=u.getLinkedRecords(g);u.copyFieldsFrom(l);q=[];r=new Set();if(c.args.after!=null||((d=(e=k)==null?void 0:e.length)!=null?d:0)===0){p((l=f)!=null?l:[],q,r)}p((c=k)!=null?c:[],q,r);u.setLinkedRecords(q,g);if(s==null){b("recoverableViolation")("Client page info is null after initial request, this is really really bad and will lead to erratic refetch behavior","comet_feed");return}o(k,q,u,s)}function o(a,b,c,d){var e=i.get(),f=e.END_CURSOR,g=e.HAS_NEXT_PAGE,h=e.HAS_PREV_PAGE;e=e.PAGE_INFO;d.setValue(!1,h);d.setValue(((h=a==null?void 0:a.length)!=null?h:0)>0,g);c.setLinkedRecord(d,e);a=b!=null?b[b.length-1]:null;h=null;a!=null&&(h=a.getValue("cursor"));d.setValue(h,f)}function c(a,b,c){b=k(l,b,null);return a.getLinkedRecord(b,c)}function d(a,c,d){return b("RelayFBConnectionHandler_UNSTABLE").unstable_getAllConnectionsWithKey(a,c,d,l)}function p(a,c,d){var e=i.get();e=e.NODE;for(var f=0;f<a.length;f++){var g=a[f];if(!g)continue;var h=g.getLinkedRecord(e);h=h&&h.getDataID();if(h==null){b("FBLogger")("comet_feed").mustfix("Found edge without deduplication nodeID in comet_news_feed, this can lead to duplicate feed stories being rendered");c.push(g);continue}if(d.has(h))continue;d.add(h);c.push(g)}}function f(a,c,d,e){if(d==null)return d;var f=i.get();f=f.EDGES;var g=c.getValue(m);if(!(typeof g==="number"))throw b("unrecoverableViolation")("CometNewsFeedConnectionHandler: Expected edgeIndex to be a number","comet_feed");e=(e=e)!=null?e:j(c.getDataID(),f,g);f=a.create(e,d.getType());f.copyFieldsFrom(d);c.setValue(g+1,m);return f}e.exports={buildConnectionEdge:f,getConnection:c,insertEdgeBefore:h.insertEdgeBefore,unstable_getAllConnectionsWithKey:d,update:a}}),null);
__d("createUFI2SmartComposeTypeaheadComposerPlugin",["requireCond","DraftModifier","EditorState","Keys","React","SelectionState","SimpleNUXMessage","SimpleNUXMessageTypes","SmartComposeTypeaheadHelper","cr:1265698","createUFI2ComposerPlugin","installUFI2ComposerInputDecorators"],(function(a,b,c,d,e,f){"use strict";var g=b("React");function a(a){var c=a.environment,d=a.ftentidentifier,e=a.surface;return function(a){var f=new(b("SmartComposeTypeaheadHelper"))(e,c,d),h=function(d){babelHelpers.inheritsLoose(c,d);function c(a){var c;c=d.call(this,a)||this;c.state={nuxShown:b("cr:1265698")!=null&&!b("SimpleNUXMessage").hasUserSeenMessage(b("SimpleNUXMessageTypes").WORK_SMART_COMPOSE_NUX),typeahead:""};c.wrappedRef=g.createRef();c.$1=function(){if(!c.state.nuxShown)return;b("SimpleNUXMessage").markMessageSeenByUser(b("SimpleNUXMessageTypes").WORK_SMART_COMPOSE_NUX);c.setState({nuxShown:!1})};c.handleKeypress=function(a){f.updateTypeSpeed();if(c.state.typeahead.length>0&&c.getCursorAtEnd())switch(a.keyCode){case b("Keys").RIGHT:case b("Keys").TAB:c.commitTypeahead();a.preventDefault();c.$1();break}return c.props.inputProps.keyBindingFn&&c.props.inputProps.keyBindingFn(a)};return c}var e=c.prototype;e.render=function(){var c=this;f.setEnteredText(this.getEnteredText());f.setCursorAtEnd(this.getCursorAtEnd());return g.jsxs("div",{ref:this.wrappedRef,children:[g.jsx(a,babelHelpers["extends"]({},this.props,{inputProps:babelHelpers["extends"]({},this.props.inputProps,{composerState:b("installUFI2ComposerInputDecorators")(this.props.inputProps.composerState,f.getDraftDecorator()),keyBindingFn:this.handleKeypress})})),b("cr:1265698")&&g.jsx(b("cr:1265698"),{contextRef:function(){return c.wrappedRef.current},onCloseButtonClick:this.$1,shown:this.state.nuxShown&&this.state.typeahead!==""})]})};e.componentDidMount=function(){var a=this;f.onSuggestionChange(function(b){return a.setState({typeahead:b})})};e.componentWillUnmount=function(){f.reset()};e.commitTypeahead=function(){var a=this,c=this.state.typeahead;if(c.length===0)return;f.logSuggestionInserted();this.props.inputProps.onComposerStateChange(function(d){var e=d.inputState;if(e.__type!=="editor-state-based")return d;var f=e.editorState,g=f.getCurrentContent(),h=f.getSelection(),i=a.getEnteredText().length+c.length;i=new(b("SelectionState"))({anchorKey:h.getAnchorKey(),anchorOffset:i,focusKey:h.getFocusKey(),focusOffset:i,hasFocus:!0,isBackward:!1});return babelHelpers["extends"]({},d,{inputState:babelHelpers["extends"]({},e,{editorState:b("EditorState").forceSelection(b("EditorState").push(f,b("DraftModifier").insertText(g,h,c),"insert-fragment"),i)})})})};e.getEnteredText=function(){var a=this.props.inputProps.composerState.inputState;return a.__type==="editor-state-based"?a.editorState.getCurrentContent().getPlainText():a.text};e.getCursorAtEnd=function(){var a=this.props.inputProps.composerState.inputState,b=!1;f.setIsEditorStateBased(a.__type==="editor-state-based");if(a.__type==="editor-state-based"){var c=a.editorState.getSelection(),d=a.editorState.getCurrentContent(),e=c.getAnchorKey();e=d.getBlockForKey(e);var g=c.getStartOffset();c=c.getEndOffset();b=e===d.getLastBlock()&&g===c&&g===e.getText().length;f.setLastBlockKey(d.getLastBlock().getKey());f.setLastBlockEnteredText(d.getLastBlock().getText())}else{g=((c=a.selectionOffsets)==null?void 0:c.start)||0;d=((e=a.selectionOffsets)==null?void 0:e.end)||0;b=g==d&&g===a.text.length}return b};return c}(g.Component);return b("createUFI2ComposerPlugin")(h)}}e.exports=a}),null);